(()=>{"use strict";var e={6752:function(e,t,i){var o=this&&this.__createBinding||(Object.create?function(e,t,i,o){void 0===o&&(o=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,o,r)}:function(e,t,i,o){void 0===o&&(o=i),e[o]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&o(t,e,i);return r(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(i(6860)),u=n(i(1185)),d=n(i(3487)),c=n(i(3582)),l=n(i(7806)),h=n(i(9470)),f=i(9905),p=i(9204),y=n(i(4350)),v=i(6087);t.default=class{constructor(e){this.app=(0,a.default)(),this.port=process.env.PORT||5e3,this.production=!0,this.connectToDatabase(),this.initializeMiddlewares(),this.initializeRoutes(e),this.initializeErrorMiddleware(),this.intializeSwagger()}initializeMiddlewares(){this.production?(this.app.use((0,d.default)()),this.app.use((0,l.default)()),this.app.use((0,h.default)("combined")),this.app.use((0,c.default)({origin:"social-admin-prod.herokuapp.com",credentials:!0}))):(this.app.use((0,h.default)("dev")),this.app.use((0,c.default)({origin:!0,credentials:!0}))),this.app.use((0,a.json)()),this.app.use(a.default.urlencoded({extended:!0}))}initializeRoutes(e){e.forEach((e=>{this.app.use("/",e.router)}))}initializeErrorMiddleware(){this.app.use(p.errorMiddleware)}Listen(){this.app.listen(this.port,(()=>{f.Logger.info(`server is listening on port ${this.port}`)}))}connectToDatabase(){try{const e=process.env.MONGO_URI;if(!e)return void f.Logger.error("Connect string is invalid");u.default.connect(e),f.Logger.info("Database connect....")}catch(e){f.Logger.error("Connect to database error")}}intializeSwagger(){(0,y.default)(this.app)(v.SWAGGER_OPTIONS)}}},8716:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>e.startsWith("http://")||e.startsWith("https://")?e:"http://"+e},6087:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SWAGGER_OPTIONS=void 0,t.SWAGGER_OPTIONS={info:{version:"1.0.0",title:"Social"},security:{JWT:{type:"apiKey",name:"x-auth-token",in:"header",description:"JWT token",scheme:"apiKey"}},baseDir:__dirname,filesPattern:"../**/*route.ts",swaggerUIPath:"/swagger",exposeSwaggerUI:!0,exposeApiDocs:!1,notRequiredAsNullable:!1,swaggerUiOptions:{},multiple:!0}},4427:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(t),this.static=e,this.message=t}}t.default=i},5729:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpException=void 0;const r=o(i(4427));t.HttpException=r.default},5191:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(9344)),s=i(9905);t.default=(e,t,i)=>{const o=e.header("x-auth-token");if(!o)return t.status(401).json({message:"No token, authorization denied"});try{const t=r.default.verify(o,process.env.JWT_TOKEN_SECRET);e.user||(e.user={id:""}),e.user.id=t.id,i()}catch(e){return s.Logger.error("token expiration"),t.status(401).json({message:"token expiration"})}}},8738:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(9905);t.default=(e,t,i,r)=>{const s=e.static||500,n=e.message||"Some thing when wrong";o.Logger.error(`[ERROR] - ${s} - Msg : ${n}`),i.status(s).json({message:n})}},9204:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authMiddleware=t.validationMiddleware=t.errorMiddleware=void 0;const r=o(i(5191));t.authMiddleware=r.default;const s=o(i(8738));t.errorMiddleware=s.default;const n=o(i(1580));t.validationMiddleware=n.default},1580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(5729),r=i(136),s=i(5849);t.default=(e,t=!1)=>(i,n,a)=>{(0,s.validate)((0,r.plainToClass)(e,i.body),{skipMissingProperties:t}).then((e=>{if(e.length>0){console.log("errors",e);const t=e.map((e=>Object.values(e.constraints))).join(", ");a(new o.HttpException(400,t))}else a()}))}},7093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=void 0,t.isEmptyObject=e=>!Object.keys(e).length},9905:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=t.validateEnv=t.Logger=void 0;const r=i(7093);Object.defineProperty(t,"isEmptyObject",{enumerable:!0,get:function(){return r.isEmptyObject}});const s=o(i(1495));t.Logger=s.default;const n=o(i(1557));t.validateEnv=n.default},1495:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(7773)),s=r.default.createLogger({transports:[new r.default.transports.File({filename:"logs/error.log",level:"error"}),new r.default.transports.File({filename:"logs/combined.log"})],format:r.default.format.combine(r.default.format.colorize({all:!0}),r.default.format.simple())});t.default=s},1557:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(9381);t.default=()=>{(0,o.cleanEnv)(process.env,{NODE_ENV:(0,o.str)(),MONGO_URI:(0,o.str)()})}},4679:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(857));t.default=class{constructor(){this.authService=new s.default,this.login=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=yield this.authService.login(i);t.status(200).json(o)}catch(e){i(e)}})),this.getCurrentLoginUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=yield this.authService.getCurrentLoginUSer(e.user.id);t.status(200).json(i)}catch(e){i(e)}}))}}},2679:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6860),s=i(9204),n=o(i(4679));t.default=class{constructor(){this.path="/api/v1/auth",this.router=(0,r.Router)(),this.authController=new n.default,this.intializeRouters()}intializeRouters(){this.router.post(this.path,this.authController.login),this.router.get(this.path,s.authMiddleware,this.authController.getCurrentLoginUser)}}},857:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(8432)),n=i(9905),a=i(5729),u=r(i(9344)),d=i(110);t.default=class{constructor(){this.userSchema=d.UserSchema}login(e){return o(this,void 0,void 0,(function*(){if((0,n.isEmptyObject)(e))throw new a.HttpException(400,"Model is empty");const t=yield this.userSchema.findOne({email:e.email});if(!t)throw new a.HttpException(409,`Your email ${e.email} is not exits`);if(!(yield s.default.compare(e.password,t.password)))throw new a.HttpException(400,"Credential is not valid");return this.createToken(t)}))}getCurrentLoginUSer(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findById(e);if(!t)throw new a.HttpException(404,"User is not exits");return t}))}createToken(e){const t={id:e._id},i=process.env.JWT_TOKEN_SECRET;return{token:u.default.sign(t,i,{expiresIn:3600})}}}},6553:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthRoute=t.AuthController=void 0;const r=o(i(4679));t.AuthController=r.default;const s=o(i(2679));t.AuthRoute=s.default},6942:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(9259));t.default=class{constructor(){this.conversationService=new s.default,this.sendMessage=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.body;try{const e=yield this.conversationService.sendMessage(o,r);t.status(201).json(e)}catch(e){i(e)}})),this.getMyConverSation=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id;try{const e=yield this.conversationService.getMyConverSation(o);t.status(200).json(e)}catch(e){i(e)}}))}}},3423:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(1185)),s=new r.default.Schema({user1:{type:r.default.Schema.Types.ObjectId,require:!0},user2:{type:r.default.Schema.Types.ObjectId,require:!0},date:{type:Date,default:Date.now},recent_date:{type:String,default:Date.now},message:[{from:{type:r.default.Schema.Types.ObjectId,require:!0},to:{type:r.default.Schema.Types.ObjectId,require:!0},read:{type:Boolean,default:!1},text:{type:String,required:!0},date:{type:Date,default:Date.now},show_on_from:{type:Boolean,default:!0},show_on_to:{type:Boolean,default:!0}}]});t.default=r.default.model("conversation",s)},8479:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6860),s=o(i(1056)),n=o(i(6942)),a=i(9204);t.default=class{constructor(){this.path="/api/v1/conversations",this.router=(0,r.Router)(),this.conversationController=new n.default,this.initializeRoutes()}initializeRoutes(){this.router.post(`${this.path}`,a.authMiddleware,(0,a.validationMiddleware)(s.default,!0),this.conversationController.sendMessage),this.router.get(`${this.path}`,a.authMiddleware,this.conversationController.getMyConverSation)}}},9259:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(110),s=i(5729),n=i(9577);t.default=class{constructor(){this.sendMessage=(e,t)=>o(this,void 0,void 0,(function*(){if(!(yield r.UserSchema.findById(e).select("-password").exec()))throw new s.HttpException(400,"User id is not exits");if(!(yield r.UserSchema.findById(t.to).exec()))throw new s.HttpException(400,"To user id is not exits");if(t.conversationId){const i=yield n.ConversationSchema.findById(t.conversationId).exec();if(!i)throw new s.HttpException(400,"Conversation id is not exits");if(i.user1!==e&&i.user2!==t.to||i.user1!==t.to&&i.user2!==e)throw new s.HttpException(400,"Conversation id is not valid");return i.message.unshift({to:t.to,text:t.text,from:e}),yield i.save(),i}{let i=yield n.ConversationSchema.findOne({$or:[{$and:[{user1:e},{user2:t.to}]},{$and:[{user2:e},{user1:t.to}]}]}).exec();return i?i.message.unshift({to:t.to,text:t.text,from:e}):i=new n.ConversationSchema({user1:e,user2:t.to,messages:[{from:e,to:t.to,text:t.text}]}),yield i.save(),i}})),this.getMyConverSation=e=>o(this,void 0,void 0,(function*(){if(!(yield r.UserSchema.findById(e).select("-password").exec()))throw new s.HttpException(400,"User id is not exits");return yield n.ConversationSchema.find({$or:[{user1:e},{user2:e}]}).sort({recent_date:-1}).exec()}))}}},1056:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"conversationId",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"to",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0)},9577:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationRoute=t.ConversationSchema=void 0;const r=o(i(3423));t.ConversationSchema=r.default;const s=o(i(8479));t.ConversationRoute=s.default},8488:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"name",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"code",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"description",void 0)},3215:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"userId",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"role",void 0)},5321:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6043));t.default=class{constructor(){this.groupService=new s.default,this.createGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.body;try{const e=yield this.groupService.createGroup(o,r);t.status(201).json(e)}catch(e){i(e)}})),this.getAllGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.groupService.getAllGroup();t.status(200).json(e)}catch(e){i(e)}})),this.updateGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id,r=e.body;try{const e=yield this.groupService.updateGroup(o,r);t.status(200).json(e)}catch(e){i(e)}})),this.deleteGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const e=yield this.groupService.deleteGroup(o);t.status(200).json(e)}catch(e){i(e)}})),this.joinGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.id;try{const e=yield this.groupService.joinGroup(o,r);t.status(200).json(e)}catch(e){i(e)}})),this.approveJoinGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.group_id,o=e.params.user_id,r=yield this.groupService.approveJoinGroup(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.addManager=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.body,r=yield this.groupService.addManager(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.removeManager=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.group_id,o=e.params.user_id,r=yield this.groupService.removeManager(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.getAllMembers=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const e=yield this.groupService.getAllMembers(o);t.status(200).json(e)}catch(e){i(e)}})),this.removeMember=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.group_id,r=e.params.user_id;try{const e=yield this.groupService.removeMember(o,r);t.status(200).json(e)}catch(e){i(e)}}))}}},9808:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(1185)),s=new r.default.Schema({name:{type:String,require:!0},code:{type:String,require:!0},description:{type:String},members:[{user:{type:r.default.Schema.Types.ObjectId},join_date:{type:Date,default:Date.now}}],member_request:[{user:{type:r.default.Schema.Types.ObjectId},join_date:{type:Date,default:Date.now}}],manager:[{user:{type:r.default.Schema.Types.ObjectId},role:{type:String,enum:["admin","mod"],default:"admin"}}],creator:{type:r.default.Schema.Types.ObjectId,ref:"user"},date:{type:Date,default:Date.now}});t.default=r.default.model("groups",s)},4384:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(9204),s=i(6860),n=o(i(8488)),a=o(i(5321)),u=o(i(3215));t.default=class{constructor(){this.path="/api/v1/groups",this.router=(0,s.Router)(),this.groupsController=new a.default,this.initializeRoutes()}initializeRoutes(){this.router.post(`${this.path}`,r.authMiddleware,(0,r.validationMiddleware)(n.default,!0),this.groupsController.createGroup),this.router.get(`${this.path}`,this.groupsController.getAllGroup),this.router.put(`${this.path}/:id`,r.authMiddleware,(0,r.validationMiddleware)(n.default,!0),this.groupsController.updateGroup),this.router.delete(`${this.path}/:id`,this.groupsController.deleteGroup),this.router.post(`${this.path}/members/:id`,r.authMiddleware,this.groupsController.joinGroup),this.router.put(`${this.path}/members/:user_id/:group_id`,r.authMiddleware,this.groupsController.joinGroup),this.router.get(`${this.path}/members/:id`,this.groupsController.getAllMembers),this.router.delete(`${this.path}/members/:group_id/:user_id`,r.authMiddleware,this.groupsController.removeMember),this.router.post(`${this.path}/manager/:id`,r.authMiddleware,(0,r.validationMiddleware)(u.default,!0),this.groupsController.addManager),this.router.delete(`${this.path}/manager/:group_id/:user_id`,r.authMiddleware,this.groupsController.removeManager)}}},6043:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(110),s=i(5729),n=i(7300);t.default=class{constructor(){this.createGroup=(e,t)=>o(this,void 0,void 0,(function*(){if(!(yield r.UserSchema.findById(e).select("-password").exec()))throw new s.HttpException(400,"User id is not exits");if((yield n.GroupSchema.find({$or:[{name:t.name},{code:t.code}]}).exec()).length>0)throw new s.HttpException(400,"Name or code existed");const i=new n.GroupSchema(Object.assign({},t));return yield i.save()})),this.getAllGroup=()=>o(this,void 0,void 0,(function*(){return n.GroupSchema.find().sort({date:-1}).exec()})),this.updateGroup=(e,t)=>o(this,void 0,void 0,(function*(){if(!(yield n.GroupSchema.findById(e).exec()))throw new s.HttpException(400,"Group id is not exits");if((yield n.GroupSchema.find({$and:[{$or:[{name:t.name},{code:t.code}]},{_id:{$ne:{_id:e}}}]}).exec()).length>0)throw new s.HttpException(400," Name or code existed");const i=Object.assign({},t),o=yield n.GroupSchema.findOneAndUpdate({_id:e},{$set:i},{new:!0}).exec();if(!o)throw new s.HttpException(400,"Update is not success");return o})),this.deleteGroup=e=>o(this,void 0,void 0,(function*(){if(!(yield n.GroupSchema.findById(e).exec()))throw new s.HttpException(400,"Group id is not exist");const t=yield n.GroupSchema.findOneAndDelete({_id:e}).exec();if(!t)throw new s.HttpException(400," Update is not success");return t})),this.joinGroup=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new s.HttpException(400,"Group id is not exits");if(!(yield r.UserSchema.findById(e).select("-password").exec()))throw new s.HttpException(400,"User id is not exist");if(i.member_request&&i.member_request.some((t=>t.user.toString()===e)))throw new s.HttpException(400,"You has already been resquested to join this group");if(i.members&&i.members.some((t=>t.user.toString()===e)))throw new s.HttpException(400,"You has already been be member of this group");return i.member_request.unshift({user:e}),yield i.save(),i})),this.addManager=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(e).exec();if(!i)throw new s.HttpException(400,"Group id is not exist");if(!(yield r.UserSchema.findById(t.userId).select("-password").exec()))throw new s.HttpException(400,"User id is not exist");if(i.manager&&i.manager.some((e=>e.user.toString()===t.userId)))throw new s.HttpException(400,"You has already been set manager to this group ");return i.manager.unshift({user:t.userId,role:t.role}),yield i.save(),i})),this.removeManager=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(e).exec();if(!i)throw new s.HttpException(400,"Group id is not exist");if(!(yield n.GroupSchema.findById(t).select("-password").exec()))throw new s.HttpException(400,"User id is not exits");if(i.manager&&i.manager.some((e=>e.user.toString()!==t)))throw new s.HttpException(400,"You has not yet been manager of this group ");return i.manager=i.manager.filter((({user:e})=>e.toString()!==t)),yield i.save(),i})),this.getAllMembers=e=>o(this,void 0,void 0,(function*(){const t=yield n.GroupSchema.findById(e).exec();if(!t)throw new s.HttpException(400,"Group id is exits");const i=t.members.map((e=>e.user));return r.UserSchema.find({_id:i}).select("-password").exec()})),this.removeMember=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(e).exec();if(!i)throw new s.HttpException(400,"Group id is exits");if(!(yield n.GroupSchema.findById(t).exec()))throw new s.HttpException(400,"User id is not exits");if(i.members&&-1==i.members.findIndex((e=>e.user.toString()===t)))throw new s.HttpException(400,"You has not been member of this group ");if(1==i.members.length)throw new s.HttpException(400,"You are last member of this group");return i.members=i.members.filter((({user:e})=>e.toString()!==t)),yield i.save(),i}))}approveJoinGroup(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new s.HttpException(400,"Group id is not exist");if(!(yield r.UserSchema.findById(e).select("-password").exec()))throw new s.HttpException(400,"User id is not exist");if(i.member_request&&i.member_request.some((t=>t.user.toString()!==e)))throw new s.HttpException(400,"There is not any request of this user");if(i.members&&i.members.some((t=>t.user.toString()===e)))throw new s.HttpException(400,"This user has already been in group");return i.member_request=i.member_request.filter((({user:t})=>t.toString()!==e)),i.members.unshift({user:e}),yield i.save(),i}))}}},7300:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GroupRoute=t.GroupSchema=void 0;const r=o(i(9808));t.GroupSchema=r.default;const s=o(i(4384));t.GroupRoute=s.default},6145:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.index=(e,t,i)=>{try{t.status(200).send("API is running...")}catch(e){i(e)}}}}},304:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6860),s=o(i(6145));t.default=class{constructor(){this.path="/",this.router=(0,r.Router)(),this.indexController=new s.default,this.intializeRouters()}intializeRouters(){this.router.get(this.path,this.indexController.index)}}},1570:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IndexRoute=t.IndexController=void 0;const r=o(i(6145));t.IndexController=r.default;const s=o(i(304));t.IndexRoute=s.default},6875:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"userId",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"postId",void 0)},5303:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0)},2484:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostRoute=t.PostSchema=void 0;const r=o(i(2279));t.PostSchema=r.default;const s=o(i(3));t.PostRoute=s.default},1531:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(3254));t.default=class{constructor(){this.PostServices=new s.default,this.createPost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=e.user.id,r=yield this.PostServices.createPost(o,i);t.status(201).json(r)}catch(e){i(e)}})),this.updatePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=e.params.id,r=yield this.PostServices.updatePost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.getAllPosts=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.PostServices.getAllPosts();t.status(200).json(e)}catch(e){i(e)}})),this.getByIdPost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.PostServices.getPostById(i);t.status(200).json(o)}catch(e){i(e)}})),this.getAllPaging=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=Number(e.params.page),o=e.query.text||"",r=yield this.PostServices.getAllPaging(o.toString(),i);t.status(200).json(r)}catch(e){i(e)}})),this.deletePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=yield this.PostServices.deletePost(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.likePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=yield this.PostServices.LikePost(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.unlikePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=yield this.PostServices.UnlikePost(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.addComment=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body.text,o=e.user.id,r=e.params.id,s=yield this.PostServices.addComment({text:i,userId:o,postId:r});t.status(201).json(s)}catch(e){i(e)}})),this.deleteComment=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=e.params.comment_id,s=yield this.PostServices.deleteComment(r,o,i);t.status(200).json(s)}catch(e){i(e)}})),this.sharePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=yield this.PostServices.Share(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.deleteShare=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.params.id,r=yield this.PostServices.deleteShare(i,o);t.status(200).json(r)}catch(e){i(e)}}))}}},2279:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostSchema=void 0;const r=o(i(1185));t.PostSchema=new r.default.Schema({user:{type:r.default.Schema.Types.ObjectId,ref:"user"},text:{type:String,require:!0},name:{type:String},avatar:{type:String},likes:[{user:{type:r.default.Schema.Types.ObjectId}}],comments:[{user:{type:r.default.Schema.Types.ObjectId},text:{type:String,require:!0},name:{type:String},avatar:{type:String},date:{type:Date,default:Date.now}}],shares:[{user:{type:r.default.Schema.Types.ObjectId}}],date:{type:Date,default:Date.now}}),t.default=r.default.model("post",t.PostSchema)},3:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(9204),s=i(6860),n=o(i(5303)),a=o(i(1531)),u=o(i(6875));t.default=class{constructor(){this.path="/api/v1/posts",this.router=(0,s.Router)(),this.postsController=new a.default,this.initializeRoutes()}initializeRoutes(){this.router.post(`${this.path}`,r.authMiddleware,(0,r.validationMiddleware)(n.default,!0),this.postsController.createPost),this.router.put(`${this.path}/:id`,r.authMiddleware,(0,r.validationMiddleware)(n.default,!0),this.postsController.updatePost),this.router.get(`${this.path}`,this.postsController.getAllPosts),this.router.get(`${this.path}/:id`,this.postsController.getByIdPost),this.router.get(`${this.path}/paging/:page`,this.postsController.getAllPaging),this.router.delete(`${this.path}/:id`,r.authMiddleware,this.postsController.deletePost),this.router.post(`${this.path}/like/:id`,r.authMiddleware,this.postsController.likePost),this.router.delete(`${this.path}/like/:id`,r.authMiddleware,this.postsController.unlikePost),this.router.post(`${this.path}/comments/:id`,r.authMiddleware,(0,r.validationMiddleware)(u.default,!0),this.postsController.addComment),this.router.delete(`${this.path}/comments/:id/:comment_id`,r.authMiddleware,this.postsController.deleteComment),this.router.post(`${this.path}/share/:id`,r.authMiddleware,this.postsController.sharePost),this.router.delete(`${this.path}/share/:id`,r.authMiddleware,this.postsController.deleteShare)}}},3254:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5729),s=i(2484),n=i(110);t.default=class{constructor(){this.createPost=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.UserSchema.findById(e).select("-password").exec();if(!i)throw new r.HttpException(400,"User id is not exits");const o=new s.PostSchema({text:t.text,name:i.first_name+" "+i.last_name,avatar:i.avatar,user:e});return yield o.save()})),this.updatePost=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findByIdAndUpdate(e,Object.assign({},t),{new:!0}).exec();if(!i)throw new r.HttpException(400,"Post is not found");return i})),this.getAllPosts=()=>o(this,void 0,void 0,(function*(){return yield s.PostSchema.find().sort({date:-1}).exec()})),this.getPostById=e=>o(this,void 0,void 0,(function*(){const t=yield s.PostSchema.findById(e).exec();if(!t)throw new r.HttpException(400,"Post is not found");return t})),this.getAllPaging=(e,t)=>o(this,void 0,void 0,(function*(){const i=10|Number(process.env.PAGE_SIZE);let o={};e&&(o={$or:[{text:e}]});const n=yield s.PostSchema.find(o).skip((t-1)*i).limit(i).exec(),a=yield s.PostSchema.find(o).countDocuments().exec();if(!n)throw new r.HttpException(400,"Post is not found");return{total:a,page:t,pageSize:i,items:n}})),this.deletePost=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findByIdAndRemove(t).exec();if(!i)throw new r.HttpException(400,"Post is not found ");if(i.user.toString()!==e)throw new r.HttpException(400,"User is not authorized");return i})),this.LikePost=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new r.HttpException(400,"Post not found");if(i.likes.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"Post already liked");return i.likes.unshift({user:e}),yield i.save(),i.likes})),this.UnlikePost=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new r.HttpException(400,"Post not found");if(!i.likes.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"Post has not yet been liked");return i.likes=i.likes.filter((({user:t})=>t.toString()!==e)),yield i.save(),i.likes})),this.addComment=e=>o(this,void 0,void 0,(function*(){const t=yield s.PostSchema.findById(e.postId).exec();if(!t)throw new r.HttpException(400,"Post not found");const i=yield n.UserSchema.findById(e.userId).select("-password").exec();if(!i)throw new r.HttpException(400,"User not found ");const o={text:e.text,name:i.first_name+" "+i.last_name,avatar:i.avatar,user:e.userId};return t.comments.unshift(o),yield t.save(),t.comments})),this.deleteComment=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=yield s.PostSchema.findById(t).exec();if(!o)throw new r.HttpException(400,"Post not found");const n=o.comments.find((t=>t._id.toString()===e));if(!n)throw new r.HttpException(400,"Comment not found");if(n.user.toString()!==i)throw new r.HttpException(401,"User not authorized");return o.comments=o.comments.filter((({_id:t})=>t.toString()!==e)),yield o.save(),o.comments})),this.Share=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new r.HttpException(400,"Post not found");if(i.shares&&i.shares.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"Post already shares ");return i.shares||(i.shares=[]),i.shares.unshift({user:e}),yield i.save(),i.shares})),this.deleteShare=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new r.HttpException(400,"Post not found");if(i.shares&&!i.shares.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"Post has not yet been shares");return i.shares||(i.shares=[]),i.shares=i.shares.filter((({user:t})=>t.toString()!==e)),i.save(),i.shares}))}}},3685:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{constructor(e,t,i,o,r,s,n,a,u,d,c){this.company=e,this.location=t,this.website=i,this.bio=o,this.skills=r,this.status=s,this.youtube=n,this.facebook=c,this.twitter=a,this.instagram=u,this.linkedin=d}}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"company",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"location",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"website",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"bio",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"skills",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"status",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"youtube",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"facebook",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"twitter",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"instagram",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"linkedin",void 0)},418:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileRoute=t.ProfileSchema=void 0;const r=o(i(4731));t.ProfileRoute=r.default;const s=o(i(4202));t.ProfileSchema=s.default},2641:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(2758));t.default=class{constructor(){this.profileServices=new s.default,this.getCurrentProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=yield this.profileServices.getCurrentProfile(i);t.status(200).json(o)}catch(e){i(e)}})),this.createProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileServices.createProfile(r,o);t.status(201).json({data:e})}catch(e){i(e)}})),this.getByUserId=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=yield this.profileServices.getCurrentProfile(e.params.id);t.status(200).json({data:i,message:"updated"})}catch(e){i(e)}})),this.getAllProfiles=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.profileServices.getAllProfiles();t.status(200).json(e)}catch(e){i(e)}})),this.deleteProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{yield this.profileServices.deleteProfile(o),t.status(200)}catch(e){i(e)}})),this.createExperience=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileServices.addExperience(r,o);t.status(201).json(e)}catch(e){i(e)}})),this.deleteExperience=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.exp_id;try{const e=yield this.profileServices.deleteExperience(o,r);t.status(200).json(e)}catch(e){i(e)}})),this.createEducation=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileServices.addEducation(r,o);t.status(201).json(e)}catch(e){i(e)}})),this.deleteEducation=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.edu_id;try{const e=yield this.profileServices.deleteEducation(o,r);t.status(201).json(e)}catch(e){i(e)}})),this.follow=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileServices.follow(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.unfollow=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileServices.unFollow(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.addFriend=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.id;try{const e=yield this.profileServices.addFriend(o,r);t.status(200).json(e)}catch(e){i(e)}})),this.unFriend=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.id;try{const e=yield this.profileServices.unFriend(o,r);t.status(200).json(e)}catch(e){i(e)}})),this.acceptFriendRequest=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.id;try{const e=yield this.profileServices.acceptFriendRequest(o,r);t.status(200).json(e)}catch(e){i(e)}}))}}},4202:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(1185)),s=new r.default.Schema({user:{type:r.default.Schema.Types.ObjectId,ref:"user"},company:{type:String},website:{type:String},location:{type:String},status:{type:String,required:!0},skills:{type:[String],required:!0},bio:{type:String},experience:[{title:{type:String,required:!0},company:{type:String,required:!0},location:{type:String},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,required:!0},description:{type:String}}],education:[{school:{type:String,required:!0},degree:{type:String,required:!0},fieldofstudy:{type:String,required:!0},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,required:!0},description:{type:String}}],social:{youtube:{type:String},twitter:{type:String},facebook:{type:String},instagram:{type:String},linkedin:{type:String}},following:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"}}],followers:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"}}],friends:[{user:{type:r.default.Schema.Types.ObjectId,ref:"uer"},date:{type:Date,default:Date.now}}],friend_request:[{user:{type:r.default.Schema.Types.ObjectId,ref:"uer"},date:{type:Date,default:Date.now}}],date:{type:Date,default:Date.now}});t.default=r.default.model("profile",s)},4731:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6860),s=i(9204),n=o(i(2641)),a=o(i(3685));t.default=class{constructor(){this.path="/api/v1/profile",this.router=(0,r.Router)(),this.profileController=new n.default,this.intializeRouters()}intializeRouters(){this.router.get(`${this.path}/user/:id`,this.profileController.getByUserId),this.router.get(`${this.path}`,this.profileController.getAllProfiles),this.router.get(`${this.path}/me`,s.authMiddleware,this.profileController.getCurrentProfile),this.router.post(`${this.path}`,s.authMiddleware,(0,s.validationMiddleware)(a.default,!0),this.profileController.createProfile),this.router.delete(`${this.path}/:id`,s.authMiddleware,this.profileController.deleteProfile),this.router.put(`${this.path}/experience`,s.authMiddleware,this.profileController.createExperience),this.router.delete(`${this.path}/experience/:exp_id`,s.authMiddleware,this.profileController.deleteExperience),this.router.put(`${this.path}/education`,s.authMiddleware,this.profileController.createEducation),this.router.delete(`${this.path}/education/:edu_id`,s.authMiddleware,this.profileController.deleteEducation),this.router.post(`${this.path}/following/:id`,s.authMiddleware,this.profileController.follow),this.router.delete(`${this.path}/following/:id`,s.authMiddleware,this.profileController.unfollow),this.router.post(`${this.path}/friend/:id`,s.authMiddleware,this.profileController.addFriend),this.router.delete(`${this.path}/friend/:id`,s.authMiddleware,this.profileController.unFriend),this.router.put(`${this.path}/friend/:id`,s.authMiddleware,this.profileController.acceptFriendRequest)}}},2758:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(110),n=i(418),a=i(5729),u=r(i(8716));t.default=class{constructor(){this.addExperience=(e,t)=>o(this,void 0,void 0,(function*(){const i=Object.assign({},t),o=yield n.ProfileSchema.findOne({user:e}).exec();if(!o)throw new a.HttpException(400,"There is not profile for this user");return o.experience.unshift(i),yield o.save(),o})),this.deleteExperience=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"there is not profile for this user");return i.experience=i.experience.filter((e=>e._id.toString()!==t)),yield i.save(),i})),this.addEducation=(e,t)=>o(this,void 0,void 0,(function*(){const i=Object.assign({},t),o=yield n.ProfileSchema.findOne({user:e}).exec();if(!o)throw new a.HttpException(400,"There is not profile for this user");return o.education.unshift(i),yield o.save(),o})),this.deleteEducation=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile this user");return i.education=i.education.filter((e=>e._id.toString()!==t)),i.save(),i})),this.follow=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile for your user");if(i.following&&i.following.some((e=>e.user.toString()===t)))throw new a.HttpException(400,"Target user has already been followed by from user");const o=yield n.ProfileSchema.findOne({user:t}).exec();if(!o)throw new a.HttpException(400,"There is not profile for target user");if(o.follower&&o.follower.some((t=>t.user.toString()===e)))throw new a.HttpException(400,"Target user has already been followed by from user");return i.following||(i.following=[]),i.following.unshift({user:t}),o.follower||(o.follower=[]),o.follower.unshift({user:e}),yield i.save(),yield o.save(),i})),this.unFollow=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile for your user");const o=yield n.ProfileSchema.findOne({user:t}).exec();if(!o)throw new a.HttpException(400,"There is not profile for your user");if(i.following&&i.following.some((e=>e.user.toString()===t)))throw new a.HttpException(400,"You has not been yet followed this user");if(o.follower&&-1!==o.follower.findIndex((t=>t.user.toString()===e)))throw new a.HttpException(400,"You has not been yet followed this user");return i.following||(i.following=[]),i.following=i.following.filter((({user:e})=>e.toString()!==t)),o.follower||(o.follower=[]),o.follower=o.follower.filter((({user:t})=>t.toString()!==e)),yield i.save(),yield o.save(),i})),this.addFriend=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile for your user");const o=yield n.ProfileSchema.findOne({user:t}).exec();if(!o)throw new a.HttpException(400,"There is not profile for your user");if(o.friends&&o.friends.some((e=>e.user.toString()===t)))throw new a.HttpException(400," You has been already be friend this user ");if(i.friend_request&&i.friend_request.some((t=>t.user.toString()===e)))throw new a.HttpException(400,"You has been already send friend request to this user ");return o.friend_request||(o.friend_request=[]),o.friend_request.unshift({user:e}),yield o.save(),o})),this.unFriend=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile for your user");const o=yield n.ProfileSchema.findOne({user:t}).exec();if(!o)throw new a.HttpException(400,"There is not profile for your user");if(o.friends&&-1===o.friends.findIndex((t=>t.user.toString()===e)))throw new a.HttpException(400,"You has not yet be friend this user");return i.friends||(i.friends=[]),i.friends=i.friends.filter((({user:e})=>e.toString()!==t)),o.friends||(o.friends=[]),o.friends=o.friends.filter((({user:t})=>t.toString()!==e)),yield i.save(),yield o.save(),i})),this.acceptFriendRequest=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield n.ProfileSchema.findOne({user:e}).exec();if(!i)throw new a.HttpException(400,"There is not profile for your user");const o=yield n.ProfileSchema.findOne({user:t}).exec();if(!o)throw new a.HttpException(400,"There is not profile for your user");if(o.friends&&o.friends.some((t=>t.user.toString()===e)))throw new a.HttpException(400,"You has already been friend");if(i.friends&&i.friends.some((t=>t.user.toString()===e)))throw new a.HttpException(400,"You has already been friend");if(i.friend_request&&i.friend_request.some((e=>e.user.toString()!==t)))throw new a.HttpException(400,"You has not any friend request related to this user");return i.friend_request||(i.friend_request=[]),i.friend_request=i.friend_request.filter((({user:e})=>e.toString()!==t)),i.friends||(i.friends=[]),i.friends.unshift({user:t}),o.friends||(o.friends=[]),o.friends.unshift({user:e}),yield i.save(),yield o.save(),i}))}getCurrentProfile(e){return o(this,void 0,void 0,(function*(){const t=yield n.ProfileSchema.findOne({user:e}).populate("user",["name","avatar"]).exec();if(!t)throw new a.HttpException(400,"There is not profile this user");return t}))}createProfile(e,t){return o(this,void 0,void 0,(function*(){const{company:i,location:o,website:r,bio:s,skills:a,status:d,youtube:c,twitter:l,instagram:h,linkedin:f,facebook:p}=t,y={user:e,company:i,location:o,website:r&&""!=r?(0,u.default)(r):r,bio:s,skills:Array.isArray(a)?a:a.split(",").map((e=>" "+e.trim())),status:d},v={youtube:c,twitter:l,instagram:h,linkedin:f,facebook:p};for(const[e,t]of Object.entries(v))t&&t.length>0&&(v[e]=(0,u.default)(t));return y.social=v,yield n.ProfileSchema.findOneAndUpdate({user:e},{$set:y},{new:!0,upsert:!0,setDefaultsOnInsert:!0}).exec()}))}deleteProfile(e){return o(this,void 0,void 0,(function*(){yield n.ProfileSchema.findOneAndRemove({user:e}),yield s.UserSchema.findByIdAndDelete({_id:e})}))}getAllProfiles(){return o(this,void 0,void 0,(function*(){const e=yield n.ProfileSchema.find().populate("user",["name","avatar"]);if(!e)throw new a.HttpException(401,"Profile is not exits");return e}))}}},422:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterDto=void 0;const r=o(i(6699));t.RegisterDto=r.default},6699:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5849);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"first_name",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"last_name",void 0),o([(0,r.IsNotEmpty)(),(0,r.IsEmail)()],s.prototype,"email",void 0),o([(0,r.IsNotEmpty)(),(0,r.MinLength)(6,{message:"You must enter at last 6 characters"})],s.prototype,"password",void 0)},110:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.UsersController=t.UsersRoute=void 0;const r=o(i(774));t.UsersRoute=r.default;const s=o(i(3092));t.UsersController=s.default;const n=o(i(1583));t.UserSchema=n.default},3092:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(8099));t.default=class{constructor(){this.userService=new s.default,this.register=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=yield this.userService.createUser(i);t.status(201).json(o)}catch(e){i(e)}})),this.getUserById=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.userService.getUSerByID(i);t.status(200).json(o)}catch(e){i(e)}})),this.getAll=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.userService.getAll();t.status(200).json(e)}catch(e){i(e)}})),this.getAllPaging=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=parseInt(e.params.page),o=e.query.keyword||"",r=yield this.userService.getAllPaging(o.toString(),i);t.status(200).json(r)}catch(e){i(e)}})),this.deleteUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.userService.deleteUser(i);t.status(200).json(o)}catch(e){i(e)}})),this.updateUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=yield this.userService.updateUser(e.params.id,i);t.status(200).json(o)}catch(e){i(e)}}))}}},1583:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(1185)),s=new r.default.Schema({first_name:{type:String,required:!0},last_name:{type:String,required:!0},email:{type:String,unique:!0,index:!0,required:!0},password:{type:String,required:!0},avatar:{type:String,required:!0}},{timestamps:!0});t.default=r.default.model("user",s)},774:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6860),s=o(i(3092)),n=i(9204),a=i(422);t.default=class{constructor(){this.path="/api/v1/users",this.router=(0,r.Router)(),this.usersController=new s.default,this.intializeRouters()}intializeRouters(){this.router.post(this.path,(0,n.validationMiddleware)(a.RegisterDto,!0),this.usersController.register),this.router.get(this.path+"/:id",this.usersController.getUserById),this.router.get(this.path,this.usersController.getAll),this.router.get(this.path+"/paging/:page",this.usersController.getAllPaging),this.router.get(this.path+"/paging/:page/:keyword",this.usersController.getAllPaging),this.router.delete(this.path+"/:id",n.authMiddleware,this.usersController.deleteUser),this.router.put(this.path+"/:id",n.authMiddleware,(0,n.validationMiddleware)(a.RegisterDto,!0),this.usersController.updateUser)}}},8099:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{u(o.next(e))}catch(e){s(e)}}function a(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(2178)),n=r(i(8432)),a=r(i(1583)),u=i(9905),d=i(5729),c=r(i(9344));t.default=class{constructor(){this.userSchema=a.default}createUser(e){return o(this,void 0,void 0,(function*(){if((0,u.isEmptyObject)(e))throw new d.HttpException(400,"Model is empty");if(!this.userSchema.findOne({email:e.email}))throw new d.HttpException(409,`Your email ${e.email} already exits`);const t=s.default.url(e.email,{size:"200",rating:"g",default:"mm"}),i=yield n.default.genSalt(10),o=yield n.default.hash(e.password,i),r=yield this.userSchema.create(Object.assign(Object.assign({},e),{password:o,avatar:t,date:Date.now()}));return this.createToken(r)}))}updateUser(e,t){return o(this,void 0,void 0,(function*(){if((0,u.isEmptyObject)(t))throw new d.HttpException(400,"Model is empty");const i=yield this.userSchema.findById(e).exec();if(!i)throw new d.HttpException(400,"User id is not exist");let o,r=i.avatar;if(0!==(yield this.userSchema.find({$and:[{email:{$eq:t.email}},{_id:{$ne:e}}]}).exec()).length)throw new d.HttpException(400,"Your email has been used by another user");if(r=s.default.url(t.email,{size:"200",rating:"g",default:"mm"}),t.password){const i=yield n.default.genSalt(10),s=yield n.default.hash(t.password,i);o=yield this.userSchema.findByIdAndUpdate(e,Object.assign(Object.assign({},t),{avatar:r,password:s}),{new:!0}).exec()}else o=yield this.userSchema.findByIdAndUpdate(e,Object.assign(Object.assign({},t),{avatar:r}),{new:!0}).exec();if(!o)throw new d.HttpException(409,"You are not an user");return o}))}getUSerByID(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findById(e);if(!t)throw new d.HttpException(404,"User is not exits");return t}))}getAll(){return o(this,void 0,void 0,(function*(){const e=yield this.userSchema.find();if(!e)throw new d.HttpException(404,"User is not exits");return e}))}getAllPaging(e,t){return o(this,void 0,void 0,(function*(){const i=Number(process.env.PAGE_SIZE)||10;let o={};e&&(o={$or:[{email:e},{first_name:e},{last_name:e}]});const r=yield this.userSchema.find(o).skip((t-1)*i).limit(i).exec();return{total:yield this.userSchema.find(o).countDocuments().exec(),page:t,pageSize:i,items:r}}))}deleteUser(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findByIdAndDelete(e).exec();if(!t)throw new d.HttpException(404,"Your id is invalid");return t}))}createToken(e){const t={id:e._id},i=process.env.JWT_TOKEN_SECRET;return{token:c.default.sign(t,i,{expiresIn:3600})}}}},7728:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),i(5142).config();const r=o(i(6752)),s=i(9905),n=i(6553),a=i(1570),u=i(110),d=i(418),c=i(2484),l=i(7300),h=i(9577);(0,s.validateEnv)();const f=[new a.IndexRoute,new u.UsersRoute,new n.AuthRoute,new d.ProfileRoute,new c.PostRoute,new l.GroupRoute,new h.ConversationRoute];new r.default(f).Listen()},8432:e=>{e.exports=require("bcryptjs")},136:e=>{e.exports=require("class-transformer")},5849:e=>{e.exports=require("class-validator")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},9381:e=>{e.exports=require("envalid")},6860:e=>{e.exports=require("express")},4350:e=>{e.exports=require("express-jsdoc-swagger")},2178:e=>{e.exports=require("gravatar")},7806:e=>{e.exports=require("helmet")},3487:e=>{e.exports=require("hpp")},9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},9470:e=>{e.exports=require("morgan")},7773:e=>{e.exports=require("winston")}},t={};!function i(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,i),s.exports}(7728)})();